name: üéµ SoundCloud ‚Üí Dropbox

on:
  schedule:
    - cron: '*/5 * * * *'  # Ex√©cution toutes les 5 minutes

jobs:
  download:
    runs-on: ubuntu-latest
    env:
      DROPBOX_TOKEN: ${{ secrets.DROPBOX_TOKEN }}
      SOUNDCLOUD_CLIENT_ID: ${{ secrets.SOUNDCLOUD_CLIENT_ID }}
      USERNAME: '1339565397'

    steps:
      # √âtape 1: R√©cup√©ration du code
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # N√©cessaire pour les op√©rations git

      # √âtape 2: Configuration de Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # √âtape 3: Installation des d√©pendances
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # √âtape 4: Ex√©cution du script principal
      - name: Run downloader
        run: python main.py

      # √âtape 5: Mise √† jour des fichiers JSON et push
      - name: Commit and push changes
        run: |
          # Configuration git
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # Synchronisation avec le d√©p√¥t distant
          git fetch origin main
          git reset --hard origin/main
          
          # Ajout des fichiers et commit
          git add downloaded_tracks.json failed_tracks.json
          git commit -m "Mise √† jour automatique des pistes" || echo "Aucun changement √† commiter"
          
          # Push des modifications
          git push origin main
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
